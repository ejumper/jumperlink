<section class="blogpost">
    <h2>Demonstrated Skills</h2> <ul class="skills"> <li>Creating Subdomains</li> <li>Creating Cloudflare Workers</li> <li>Making API calls</li> <li>Writing Linux Scripts</li> <li>Changing Linux File Permissions</li> <li>Writing &amp; automating Bash Scripts</li> </ul> <h2>Overview</h2> <p>While a static internal IP address will allow devices on the LAN to find my server, if I want to be able to access it outside of my local network I need a way for those devices to find the server. While theoretically this could be done with a static public address, realistically this isn&rsquo;t practical. The solution then is Dynamic DNS (DDNS). This will allow me to associate a domain with my public IP address. Since my domain&rsquo;s DNS records are stored with Cloudflare, I will use a Cloudflare worker to check my server every 30 minutes and if my public IP address has changed it will update the A record to reflect my new public IP address. Using Cloudflare instead of a traditional DDNS provider also comes with some some major advantages like, using Proxies to mask my home IP address and Cloudflares very fast caching.</p> <h2>Setup</h2> <p>The first thing I need to do is <strong>create a subdomain for my server</strong>. Inside my DNS records in my Cloudflare dashboard I select <strong>create a new record</strong>, then <strong>set the type to A, name it and enter my public IP address</strong></p> <img class="blog-img" src="content/labs/images/Screenshot from 2025-06-03 14-37-12.png"> <p>Now I need to <strong>create an API Token</strong> so my server can contact my Cloudflare account. This can be done via <strong>Manage Account &gt; Account API Tokens &gt; Create Token &gt;</strong> Then I configure it to <strong>include my domain</strong></p> <img class="blog-img" src="content/labs/images/Screenshot from 2025-06-03 15-09-02.png"> <p>Then I <strong>create the token</strong> and place it in my password manager for later use.</p> <p>Now I&rsquo;m going to go ahead and <strong>get the Zone ID and the Record ID for my domain</strong>. The zone ID is easy enough to find by <strong>selecting my domain from my dashboard homepage, finding the API menu</strong> on the right hand side of the page and <strong>selecting the string of characters under Zone ID</strong></p> <img class="blog-img" src="content/labs/images/Pasted image 20250603205626.png"> <p>I place that next to my API token in my password manager as well for easy access.</p> <p>Now I need to get ahold of my Record ID this is used by Cloudflare to distinguish DNS records in the same zone for API calls. So the Zone ID tells the API call which zone to look in and the Record ID finds the IP&rsquo;s specific DNS record within that zone. But first I will install tool that is going to make finding the record ID much easier.</p> <p>with ```sudo apt install jq``` I can get a .json parser which will return well organized a .json file.</p> <p>To find the Record ID I will return to the terminal and use the curl command, specifically to</p> <p>``` curl -X GET &quot;https://api.cloudflare.com/client/v4/zones/&lt;ZONE ID&gt;/dns_records&quot; \ -H &quot;Authorization: Bearer &lt;API TOKEN&gt;&quot; \ -H &quot;Content-Type: application/json&quot; | jq ```</p> <p>I then copy the output and past it into a text editor so I can ctrl + f for the domain name I am using and the value under &quot;id:&quot; is my record ID</p> <p>With my <strong>zone id, record id and api token</strong> I am ready to create a Cloudflare Worker!</p> <p>Under <strong>Compute (Workers) I select Workers &amp; Pages</strong>, then verifying the Workers tab is selected I choose Start with Hello World! to get a blank worker to add my script to.</p> <img class="blog-img" src="content/labs/images/Screenshot from 2025-06-03 15-58-46.png"> <p>I <strong>select deploy</strong> &gt; then <strong>select edit code</strong> and paste the script I found <a href="https://paulsorensen.io/configure-ddns-with-cloudflare/">here</a> and <strong>place my zone ID, record ID, and API token into it</strong> as well as <strong>creating a &quot;secret key&quot; (password)</strong></p> <p>Then I click deploy and I am done creating my Worker!</p> <p>The last thing to do in Cloudflare is create a Custom subdomain for the worker which is done in <strong>Worker &amp; Pages &gt; select the worker &gt; Settings &gt; Domains &amp; Routes &gt; Add &gt; Custom Domain</strong></p> <p>Now the last thing to get this running is a simple bash script on my server that can send its current public IP address to my Cloudflare Worker and update the DNS record.</p> <p>First I create this script in the nano text editor</p> <img class="blog-img" src="content/labs/images/Screenshot from 2025-06-03 16-58-06.png"> <p>Now I need to change the permissions on the file to make it executable. Then I quickly verify that the script has the correct permissions now.</p> <img class="blog-img" src="content/labs/images/Screenshot from 2025-06-03 17-05-05.png"> <p>Now I open crontab (Linux&rsquo;s task scheduler to) with chrontab -e</p> <img class="blog-img" src="content/labs/images/Screenshot from 2025-06-03 17-32-01.png"> <p>Inside I add */30 * * * * &lt;path/to/script.sh to have it check every 30 minutes if the public IP address has changed.</p> <p>Finally I go into my router settings and select restart on my Broadband Connection to try and get a new public IP address, however, this I got the same IP address, so I tried again, this time waiting about 10 minutes before reconnecting and this time I got a new IP address!</p> <img class="blog-img" src="content/labs/images/Pasted image 20250603215121.png"> <p>So I manually ran the script I made and went to Cloudflare and checked that my A record had updated and it did!</p> <img class="blog-img" src="content/labs/images/Pasted image 20250603215325.png"> <p>I now have DDNS up and running!</p>
</section>

<p>Now I need to set up port forwarding so I can expose my server to the Internet, so I can access my server from outside of it the first step is ensuring the device has a static internal IP address so the router always knows where to send traffic.</p>
</p>
<p>I begin by <strong>finding my server's IP address</strong></p>
<p><img class="blog-img" src="content/labs/images/Pasted image 20250604095943.png"></p>
<p>Then I  <strong>type my router's internal IP address into a web browser</strong>.</p>
<p>Now I need to create a Port Forwarding rule for both encrypted (port 443) and unencrypted (port 80) traffic. I can do this by going to <strong>Firewall > NAT/Gaming</strong></p>
<p><img class="blog-img" src="content/labs/images/Pasted image 20250604100450.png"></p>
<p>Now I'm prompted to enter my <strong>Device Access code</strong> which can be found on the side of my router.</p>
<p>In the predefined Services I see ones for HTTP &amp; HTTPS which is what I need but they are configured for TCP and UDP. These would work but since I won't be using UDP ports in an effort to keep things as secure and simple as possible I will <strong>create my own custom services</strong>.</p>
<p><img class="blog-img" src="content/labs/images/Pasted image 20250604101027.png"></p>
<p>The process is straightforward, I just enter the <strong>Service's name, port range, host port and protocol and select add and</strong> they appear under my custom service list.</p>
<p><img class="blog-img" src="content/labs/images/Pasted image 20250604102406.png"></p>
<p>I then <strong>return to the NAT/Gaming tab</strong>, <strong>select the service I created and my Server's IP address</strong> and <strong>select Add</strong></p>
<p><img class="blog-img" src="content/labs/images/Pasted image 20250604102946.png"></p>

</section>